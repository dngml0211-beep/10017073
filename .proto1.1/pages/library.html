<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∂ÅÌÅ¥ÎüΩ 3.0 - KRS Î¶¨Îî©Ìä∏Î¶¨</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { bg: '#FEF3C7', primary: '#FF9F43', dark: '#F368E0', secondary: '#54a0ff', green: '#1dd1a1', paper: '#FDFBF7' }
                    }
                }
            }
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Noto+Sans+KR:wght@300;400;500;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="../css/responsive.css">

    <style>
        .font-noto { font-family: 'Noto Sans KR', sans-serif; }
        .font-batang { font-family: 'Gowun Batang', serif; }
        .font-display { font-family: 'Playfair Display', serif; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }

        /* === Premium Header === */
        .library-header {
            background: linear-gradient(135deg, #fff8f0 0%, #fff4e6 50%, #fef3c7 100%);
            border-bottom: 1px solid rgba(255, 159, 67, 0.1);
        }
        .header-top-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .header-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header-brand-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #FF9F43, #f97316);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 3px 12px rgba(255, 159, 67, 0.3);
        }
        .header-brand-text {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }
        .header-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: #1a1a1a;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }
        .header-subtitle {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 11px;
            color: #9ca3af;
            font-weight: 400;
        }
        .header-level-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: white;
            border: 1px solid rgba(255, 159, 67, 0.2);
            border-radius: 20px;
            padding: 6px 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
        }
        .header-level-badge .level-label {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 12px;
            font-weight: 700;
            color: #FF9F43;
        }
        .header-level-badge .level-bar {
            width: 56px;
            height: 5px;
            background: #f3f4f6;
            border-radius: 999px;
            overflow: hidden;
        }
        .header-level-badge .level-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF9F43, #f97316);
            border-radius: 999px;
            transition: width 0.6s ease;
        }
        .header-level-badge .level-count {
            font-size: 11px;
            color: #9ca3af;
            font-weight: 500;
        }

        /* === Tab Switcher (Duolingo-style) === */
        .tab-switcher {
            display: flex;
            background: white;
            border-radius: 14px;
            padding: 4px;
            gap: 4px;
            box-shadow: 0 1px 6px rgba(0,0,0,0.06), 0 0 0 1px rgba(0,0,0,0.03);
        }
        .tab-pill {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 11px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: #b0a090;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }
        .tab-pill i {
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .tab-pill:hover:not(.active) {
            background: #fdf8f3;
            color: #8b7560;
        }
        .tab-pill.active {
            background: linear-gradient(135deg, #FF9F43, #f97316);
            color: white;
            box-shadow: 0 3px 12px rgba(255, 159, 67, 0.35);
            transform: scale(1);
        }
        .tab-pill.active i {
            color: white;
            animation: tabIconPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes tabIconPop {
            0% { transform: scale(0.8) rotate(-10deg); }
            60% { transform: scale(1.15) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        .tab-pill .tab-emoji {
            font-size: 16px;
            display: inline-block;
            transition: transform 0.3s ease;
        }
        .tab-pill.active .tab-emoji {
            animation: emojiWave 0.6s ease;
        }
        @keyframes emojiWave {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-12deg); }
            75% { transform: rotate(12deg); }
        }

        .tab-content { display: none; animation: tabFadeIn 0.35s ease; }
        .tab-content.active { display: block; }
        @keyframes tabFadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* === Page Header === */
        .page-header {
            background: transparent;
            border-bottom: none;
        }

        /* === Month Section === */
        .month-section {
            margin-bottom: 20px;
        }
        .month-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 0 4px 10px;
            cursor: pointer;
            user-select: none;
            border-bottom: 2px solid #e8e0d4;
            transition: all 0.2s;
        }
        .month-header:hover {
            border-bottom-color: #FF9F43;
        }
        .month-title-text {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1.3rem;
            font-weight: 800;
            color: #2d1b0e;
        }
        .month-title-num {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1.3rem;
            font-weight: 800;
            color: #FF9F43;
        }
        .month-toggle {
            margin-left: auto;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: rgba(255,159,67,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FF9F43;
            font-size: 12px;
            transition: all 0.3s;
        }
        .month-toggle.collapsed { transform: rotate(-90deg); }
        .month-body {
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease;
            max-height: 2000px;
            opacity: 1;
        }
        .month-body.collapsed {
            max-height: 0;
            opacity: 0;
        }
        .month-completed-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            background: rgba(16,185,129,0.1);
            color: #10b981;
        }

        /* ÏôÑÎ£åÎêú Í∞úÏõî - ÎπÑÌôúÏÑ± Ïä§ÌÉÄÏùº */
        .month-section.completed .month-title-num {
            color: #6b7280;
        }
        .month-section.completed .month-toggle {
            background: rgba(107,114,128,0.1);
            color: #9ca3af;
        }
        .month-section.completed .month-header {
            opacity: 0.75;
        }

        /* === Week Card Grid === */
        .week-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        @media (max-width: 640px) {
            .week-grid { grid-template-columns: 1fr; }
        }

        /* === Week Card === */
        .week-card {
            background: white;
            border-radius: 16px;
            border: 1px solid #f0ebe3;
            overflow: hidden;
            transition: all 0.25s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .week-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        .week-card.in-progress {
            background: linear-gradient(135deg, #FFFCF5, #FFF6E8);
            border: 2px solid #FF9F43;
            box-shadow: 0 4px 16px rgba(255,159,67,0.15), 0 0 0 3px rgba(255,159,67,0.06);
        }
        .week-card.in-progress:hover {
            box-shadow: 0 8px 28px rgba(255,159,67,0.2), 0 0 0 3px rgba(255,159,67,0.1);
        }
        .week-card.in-progress .week-card-header {
            border-bottom-color: rgba(255,159,67,0.15);
        }
        .week-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid #f5f0e8;
        }
        .week-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .week-num {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            color: white;
            background: #2d3748;
        }
        .week-level {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            color: #4a5568;
            background: #f0f0f0;
            border: 1px solid #e2e8f0;
        }
        .week-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .week-status.completed { color: #10b981; }
        .week-status.in-progress { color: #FF9F43; }
        .week-status.locked { color: #9ca3af; }

        /* Book Info Area */
        .week-card-body {
            padding: 16px;
            display: flex;
            gap: 14px;
        }
        .book-cover-box {
            flex-shrink: 0;
            width: 90px;
            height: 110px;
            border-radius: 10px;
            background: #f5f0e8;
            border: 1px solid #e8e0d4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            overflow: hidden;
            position: relative;
        }
        .book-cover-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 9px;
        }
        .book-cover-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            width: 100%;
            height: 100%;
        }
        .book-cover-placeholder i {
            font-size: 24px;
            color: #c4b8a8;
        }
        .book-cover-placeholder span {
            font-size: 8px;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: #b8a89a;
        }
        .book-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .book-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1.05rem;
            font-weight: 700;
            color: #1f2937;
            line-height: 1.3;
            margin-bottom: 4px;
        }
        .book-desc {
            font-size: 0.75rem;
            color: #6b7280;
            line-height: 1.4;
            margin-bottom: 2px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .book-author {
            font-size: 0.78rem;
            color: #9ca3af;
            margin-bottom: 10px;
        }

        /* Activity Badges */
        .activity-section {
            padding: 0 16px 14px;
        }
        .activity-label {
            font-size: 10px;
            font-weight: 600;
            color: #b8a89a;
            margin-bottom: 8px;
            letter-spacing: 0.02em;
        }
        .activity-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .activity-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            background: #f8f6f2;
            color: #4a5568;
            border: 1px solid #e8e0d4;
            transition: all 0.2s;
            cursor: pointer;
        }
        .activity-badge:hover {
            background: #FFF8F0;
            border-color: #FFE0B2;
            color: #FF9F43;
        }
        .activity-badge.done {
            background: rgba(16,185,129,0.08);
            border-color: rgba(16,185,129,0.2);
            color: #10b981;
        }
        .activity-badge i {
            font-size: 11px;
        }

        /* === Reading Step Board („Ñπ Path - Light Theme) === */
        .board-wrapper {
            background: linear-gradient(180deg, #FEF9F0 0%, #FFF6EA 50%, #FFF2E0 100%);
            min-height: 100vh;
            padding: 28px 16px 44px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }
        .board-wrapper::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(circle at 15% 85%, rgba(255,159,67,0.06) 0%, transparent 50%),
                radial-gradient(circle at 85% 15%, rgba(139,92,246,0.04) 0%, transparent 50%);
            pointer-events: none;
        }

        .board-title {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        .board-title h3 {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 25px;
            font-weight: 800;
            color: #2d1b0e;
        }
        .board-title p {
            font-size: 14px;
            color: #9ca3af;
            margin-top: 4px;
        }

        /* Summary Bar */
        .board-summary {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 24px;
            background: white;
            border-radius: 18px;
            border: 1px solid #f0ebe3;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
            max-width: 720px;
            width: 100%;
            position: relative;
            z-index: 1;
        }
        .bs-item { display: flex; flex-direction: column; align-items: center; flex: 1; }
        .bs-num { font-family: 'Noto Sans KR', sans-serif; font-size: 1.5rem; font-weight: 800; line-height: 1; }
        .bs-label { font-size: 12px; color: #9ca3af; margin-top: 4px; }
        .bs-divider { width: 1px; height: 36px; background: #f0ebe3; }

        /* Board Frame */
        .board-frame {
            width: 100%;
            max-width: 720px;
            padding: 14px;
            background: white;
            border-radius: 24px;
            border: 1px solid #f0ebe3;
            box-shadow: 0 4px 24px rgba(0,0,0,0.06);
            position: relative;
            z-index: 1;
        }

        /* Grid - „Ñπ serpentine: 5 cols, 7 rows (all auto height) */
        .board-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(7, auto);
            gap: 6px;
        }

        /* Base Tile */
        .b-tile {
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 12px 6px 10px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            overflow: visible;
            background: #f8f6f2;
            border: 1.5px solid #ebe5db;
            min-height: 96px;
        }
        .b-tile:hover {
            transform: scale(1.06) translateY(-2px);
            z-index: 5;
            box-shadow: 0 8px 28px rgba(0,0,0,0.1);
        }

        /* Color band (top of tile) */
        .b-tile .tile-band {
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 7px;
            border-radius: 14px 14px 0 0;
        }

        /* Tile content */
        .tile-lv {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 17px;
            font-weight: 800;
            color: #1f2937;
            line-height: 1.1;
            text-align: center;
            position: relative;
            z-index: 1;
            margin-top: 4px;
        }
        .tile-grade {
            font-size: 11px;
            color: #9ca3af;
            text-align: center;
            position: relative;
            z-index: 1;
            margin-top: 3px;
        }
        .tile-status-icon {
            font-size: 15px;
            margin-top: 4px;
            position: relative;
            z-index: 1;
        }

        /* Completed */
        .b-tile.st-completed { background: #f8f6f2; }
        .b-tile.st-completed .tile-lv { color: #374151; }
        .b-tile.st-completed .tile-status-icon { color: #10b981; }

        /* Current */
        .b-tile.st-current {
            background: linear-gradient(135deg, #FFF8F0, #FFE8CC);
            border: 3px solid #FF9F43;
            box-shadow: 0 0 16px rgba(255,159,67,0.25), 0 6px 16px rgba(255,159,67,0.15);
            animation: currentTileGlow 2s ease-in-out infinite;
        }
        .b-tile.st-current .tile-lv { color: #c2410c; font-size: 18px; }

        /* Locked */
        .b-tile.st-locked { background: #f5f3ef; border-color: #e8e4dc; opacity: 0.6; }
        .b-tile.st-locked .tile-lv { color: #b8b0a4; font-size: 15px; }
        .b-tile.st-locked .tile-grade { color: #c8c0b4; }

        /* Corner / Special Tiles */
        .b-tile.corner-tile {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 2.5px solid #f59e0b;
        }
        .b-tile.start-tile {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            border-color: #22c55e;
        }
        .b-tile.goal-tile {
            background: linear-gradient(135deg, #fef9c3, #fde047);
            border-color: #eab308;
        }
        .b-tile.island-tile {
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
            border-color: #0ea5e9;
        }
        .b-tile.key-tile {
            background: linear-gradient(135deg, #fce7f3, #fbcfe8);
            border-color: #ec4899;
        }
        .b-tile.bonus-tile {
            background: linear-gradient(135deg, #ede9fe, #ddd6fe);
            border-color: #8b5cf6;
        }
        .corner-icon { font-size: 28px; line-height: 1; }
        .corner-label {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 12px;
            font-weight: 800;
            color: #4a5568;
            margin-top: 4px;
        }

        /* Bridge Tile („Ñπ connector between rows) */
        .b-bridge {
            border-radius: 14px;
            min-height: 72px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            background: linear-gradient(135deg, #FFF8F0, #FFF0DD);
            border: 2.5px dashed #FFD4A0;
            cursor: default;
            position: relative;
        }
        .b-bridge i {
            color: #FF9F43;
            font-size: 22px;
        }
        .b-bridge .bridge-label {
            font-size: 10px;
            font-weight: 700;
            color: #d4a06a;
        }

        /* Avatar on current tile */
        .tile-avatar {
            position: absolute;
            top: -10px;
            right: -5px;
            width: 34px;
            height: 34px;
            background: linear-gradient(135deg, #FF9F43, #F368E0);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            border: 2.5px solid white;
            box-shadow: 0 3px 10px rgba(255,159,67,0.4);
            z-index: 3;
            animation: avatarBounce 1s ease-in-out infinite;
        }

        @keyframes currentTileGlow {
            0%, 100% { box-shadow: 0 0 16px rgba(255,159,67,0.25), 0 6px 16px rgba(255,159,67,0.15); }
            50% { box-shadow: 0 0 28px rgba(255,159,67,0.4), 0 6px 20px rgba(255,159,67,0.25); }
        }
        @keyframes avatarBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        /* Legend */
        .board-legend {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 14px 20px;
            background: rgba(255,255,255,0.8);
            border-radius: 16px;
            border: 1px solid #f0ebe3;
            max-width: 720px;
            width: 100%;
            position: relative;
            z-index: 1;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
        }
        .legend-dot {
            width: 11px;
            height: 11px;
            border-radius: 50%;
            border: 1.5px solid rgba(0,0,0,0.08);
        }

        /* Group color chips */
        .board-groups {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 10px;
            max-width: 720px;
            width: 100%;
            position: relative;
            z-index: 1;
        }
        .group-chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: rgba(255,255,255,0.8);
            border-radius: 10px;
            border: 1px solid #f0ebe3;
        }
        .group-dot {
            width: 11px;
            height: 11px;
            border-radius: 3px;
        }
        .group-name {
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
        }

        /* === Responsive === */
        @media (max-width: 768px) {
            main.flex-1 { padding-top: 4rem; }
            .month-title-text, .month-title-num { font-size: 1.1rem; }
            .header-brand-icon { width: 30px; height: 30px; font-size: 15px; border-radius: 8px; }
            .header-title { font-size: 14px; }
            .header-subtitle { font-size: 10px; }
            .header-level-badge { padding: 4px 10px; gap: 5px; }
            .header-level-badge .level-label { font-size: 11px; }
            .header-level-badge .level-bar { width: 44px; }
            .tab-pill { padding: 8px 14px; font-size: 13px; }
            .tab-pill .tab-emoji { font-size: 14px; }
            .week-card-body { gap: 10px; }
            .book-cover-box { width: 76px; height: 95px; }
            .book-title { font-size: 0.95rem; }
            .board-frame { max-width: 100%; padding: 8px; }
            .board-grid { gap: 4px; }
            .b-tile { border-radius: 10px; padding: 8px 4px 6px; min-height: 76px; }
            .b-bridge { min-height: 56px; }
            .tile-lv { font-size: 14px; }
            .tile-grade { font-size: 9px; }
            .tile-status-icon { font-size: 12px; }
            .corner-icon { font-size: 22px; }
            .corner-label { font-size: 10px; }
            .tile-avatar { width: 28px; height: 28px; font-size: 15px; top: -8px; right: -4px; }
            .board-summary { padding: 12px 16px; gap: 10px; }
            .bs-num { font-size: 1.25rem; }
        }
    </style>
</head>
<body class="bg-brand-bg font-sans text-gray-800 h-screen overflow-hidden">
    <button class="sidebar-toggle" id="sidebar-toggle-btn" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars text-gray-600 text-lg"></i>
    </button>
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

    <div class="flex w-full h-full">
        <div id="sidebar-container"></div>

        <main class="flex-1 h-full overflow-y-auto" id="main-scroll" style="scroll-behavior:smooth;">
            <!-- Sticky Header -->
            <div class="sticky top-0 z-20 library-header">
                <div class="px-5 md:px-8 pt-4 pb-4">
                    <!-- Row 1: Brand + Level -->
                    <div class="header-top-row">
                        <div class="header-brand">
                            <div class="header-brand-icon">üìñ</div>
                            <div class="header-brand-text">
                                <div class="header-title">KRS Î¶¨Îî© ÌîÑÎ°úÍ∑∏Îû®</div>
                                <div class="header-subtitle">Ïö∞Ìù¨Ïùò ÎèÖÏÑú Ïó¨Ï†ï</div>
                            </div>
                        </div>
                        <div class="header-level-badge">
                            <span class="level-label">K2-2</span>
                            <div class="level-bar">
                                <div class="level-fill" style="width:42%"></div>
                            </div>
                            <span class="level-count"><span id="completed-count">10</span>/24</span>
                        </div>
                    </div>
                    <!-- Row 2: Tab Switcher -->
                    <div class="tab-switcher" id="view-switcher">
                        <button class="tab-pill active" id="tab-btn-tree" onclick="switchTab('tree')">
                            <span class="tab-emoji">üå≥</span>
                            <span>Î¶¨Îî©Ìä∏Î¶¨</span>
                        </button>
                        <button class="tab-pill" id="tab-btn-map" onclick="switchTab('map')">
                            <span class="tab-emoji">üë£</span>
                            <span>Î¶¨Îî©Ïä§ÌÉ≠</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ======== TAB 1: KRS Î¶¨Îî©Ìä∏Î¶¨ (Month Cards) ======== -->
            <div class="tab-content active" id="tab-tree">
                <div class="px-5 md:px-8 pt-6 pb-8" id="month-container">
                    <!-- JS renders month sections -->
                </div>
            </div>

            <!-- ======== TAB 2: KRS Î¶¨Îî©Îßµ ======== -->
            <div class="tab-content" id="tab-map">
                <div class="board-wrapper" id="rmap-container">
                    <!-- JS renders board game map -->
                </div>
            </div>
        </main>
    </div>

    <div id="logout-modal-container"></div>
    <script src="../js/common.js"></script>
    <script src="../js/sidebar.js"></script>
    <script>
    // ============================================================
    //  MONTHLY DATA (6Í∞úÏõî)
    // ============================================================
    const monthlyData = [
        {
            month: 1, status: 'completed',
            weeks: [
                { week: 1, level: 'K2-1', title: 'Ïò§Ï¶àÏùò ÎßàÎ≤ïÏÇ¨', desc: 'ÌöåÏò§Î¶¨Î∞îÎûåÏóê ÎÇ†Î†§Í∞Ñ ÎèÑÎ°úÏãúÏùò Ïã†ÎπÑÎ°úÏö¥ Î™®Ìóò Ïù¥ÏïºÍ∏∞', author: 'L. ÌîÑÎû≠ÌÅ¨ Î∞îÏõÄ ÏõêÏûë', img: '../img/book1.jpg', type: 'core', status: 'completed', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: true },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: true }
                ]},
                { week: 2, level: 'K2-1', title: 'ÏïΩÏÜçÏùÄ Ï¶êÍ±∞Ïõå', desc: 'ÏïΩÏÜçÍ≥º Í∑úÏπôÏùò ÏÜåÏ§ëÌï®ÏùÑ Î∞∞Ïö∞Îäî ÏÉùÌôú ÎèôÌôî', author: 'Î∞ïÏùÄÍ≤Ω Í∏Ä', img: '../img/book2.jpg', type: 'managed', status: 'completed', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: true },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: true },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: true }
                ]},
                { week: 3, level: 'K2-1', title: 'Ïò§Ï¶àÏùò ÎßàÎ≤ïÏÇ¨', desc: 'ÌöåÏò§Î¶¨Î∞îÎûåÏóê ÎÇ†Î†§Í∞Ñ ÎèÑÎ°úÏãúÏùò Ïã†ÎπÑÎ°úÏö¥ Î™®Ìóò Ïù¥ÏïºÍ∏∞', author: 'L. ÌîÑÎû≠ÌÅ¨ Î∞îÏõÄ ÏõêÏûë', img: '../img/book1.jpg', type: 'core', status: 'completed', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: true },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: true }
                ]},
                { week: 4, level: 'K2-1', title: 'ÏïΩÏÜçÏùÄ Ï¶êÍ±∞Ïõå', desc: 'ÏïΩÏÜçÍ≥º Í∑úÏπôÏùò ÏÜåÏ§ëÌï®ÏùÑ Î∞∞Ïö∞Îäî ÏÉùÌôú ÎèôÌôî', author: 'Î∞ïÏùÄÍ≤Ω Í∏Ä', img: '../img/book2.jpg', type: 'managed', status: 'completed', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: true },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: true },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: true }
                ]}
            ]
        },
        {
            month: 2, status: 'completed',
            weeks: [
                { week: 1, level: 'K2-1', title: 'Ïà≠Ïà≠Ïù¥ÏôÄ ÎÇò', desc: 'ÌäπÎ≥ÑÌïú ÏπúÍµ¨ÏôÄ Ìï®Íªò ÏûêÎùºÎäî Ïö∞Ï†ï Ïù¥ÏïºÍ∏∞', author: 'ÏßÄÏú§Í≤Ω Í∏Ä', img: '../img/book3.jpg', type: 'core', status: 'completed', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: true },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: true }
                ]},
                { week: 2, level: 'K2-1', title: 'Îπ®Í∞ÑÎ®∏Î¶¨ Ïï§', desc: 'ÏÉÅÏÉÅÎ†• ÎÑòÏπòÎäî ÏÜåÎÖÄ Ïï§Ïùò Ï¥àÎ°ù ÏßÄÎ∂ï Ïßë Ïù¥ÏïºÍ∏∞', author: 'Î™ΩÍ≥†Î©îÎ¶¨ ÏõêÏûë', img: '../img/book4.jpg', type: 'managed', status: 'completed', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: true },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: true },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: true }
                ]},
                { week: 3, level: 'K2-1', title: 'Ïà≠Ïà≠Ïù¥ÏôÄ ÎÇò', desc: 'ÌäπÎ≥ÑÌïú ÏπúÍµ¨ÏôÄ Ìï®Íªò ÏûêÎùºÎäî Ïö∞Ï†ï Ïù¥ÏïºÍ∏∞', author: 'ÏßÄÏú§Í≤Ω Í∏Ä', img: '../img/book3.jpg', type: 'core', status: 'completed', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: true },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: true }
                ]},
                { week: 4, level: 'K2-2', title: 'ÎÇòÎ¨¥Î•º Ïã¨ÏùÄ ÏÇ¨Îûå', desc: 'Ìïú ÏÇ¨ÎûåÏùò ÎÅàÍ∏∞Í∞Ä Ïà≤ÏùÑ ÎßåÎì† Í∞êÎèô Ïã§Ìôî', author: 'Ïû• ÏßÄÏò§ÎÖ∏ ÏõêÏûë', img: '', type: 'managed', status: 'completed', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: true },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: true },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: true }
                ]}
            ]
        },
        {
            month: 3, status: 'current',
            weeks: [
                { week: 1, level: 'K2-2', title: 'Ïò§Ï¶àÏùò ÎßàÎ≤ïÏÇ¨', desc: 'ÌöåÏò§Î¶¨Î∞îÎûåÏóê ÎÇ†Î†§Í∞Ñ ÎèÑÎ°úÏãúÏùò Ïã†ÎπÑÎ°úÏö¥ Î™®Ìóò Ïù¥ÏïºÍ∏∞', author: 'L. ÌîÑÎû≠ÌÅ¨ Î∞îÏõÄ ÏõêÏûë', img: '../img/book1.jpg', type: 'core', status: 'in-progress', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 2, level: 'K2-2', title: 'ÏïΩÏÜçÏùÄ Ï¶êÍ±∞Ïõå', desc: 'ÏïΩÏÜçÍ≥º Í∑úÏπôÏùò ÏÜåÏ§ëÌï®ÏùÑ Î∞∞Ïö∞Îäî ÏÉùÌôú ÎèôÌôî', author: 'Î∞ïÏùÄÍ≤Ω Í∏Ä', img: '../img/book2.jpg', type: 'managed', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 3, level: 'K2-2', title: 'Ïà≠Ïà≠Ïù¥ÏôÄ ÎÇò', desc: 'ÌäπÎ≥ÑÌïú ÏπúÍµ¨ÏôÄ Ìï®Íªò ÏûêÎùºÎäî Ïö∞Ï†ï Ïù¥ÏïºÍ∏∞', author: 'ÏßÄÏú§Í≤Ω Í∏Ä', img: '../img/book3.jpg', type: 'core', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 4, level: 'K2-2', title: 'Îπ®Í∞ÑÎ®∏Î¶¨ Ïï§', desc: 'ÏÉÅÏÉÅÎ†• ÎÑòÏπòÎäî ÏÜåÎÖÄ Ïï§Ïùò Ï¥àÎ°ù ÏßÄÎ∂ï Ïßë Ïù¥ÏïºÍ∏∞', author: 'Î™ΩÍ≥†Î©îÎ¶¨ ÏõêÏûë', img: '../img/book4.jpg', type: 'managed', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]}
            ]
        },
        {
            month: 4, status: 'locked',
            weeks: [
                { week: 1, level: 'K2-2', title: 'ÍøàÍæ∏Îäî Î°úÎ¥á', desc: 'Î°úÎ¥áÍ≥º ÏïÑÏù¥Ïùò ÌäπÎ≥ÑÌïú Ïö∞Ï†ï Ïù¥ÏïºÍ∏∞', author: 'Ïù¥ÏßÄÌòÑ Í∏Ä', img: '', type: 'core', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 2, level: 'K2-2', title: 'ÏûëÏùÄ ÏòÅÏõÖ', desc: 'ÌèâÎ≤îÌïú ÏïÑÏù¥Í∞Ä Ïö©Í∏∞Î•º ÎÇ¥Ïñ¥ ÏòÅÏõÖÏù¥ ÎêòÎäî Ïù¥ÏïºÍ∏∞', author: 'ÍπÄÌÉúÏòÅ Í∏Ä', img: '', type: 'managed', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 3, level: 'K2-2', title: 'Ïã†ÎπÑÌïú ÎèôÍµ¥', desc: 'ÎèôÍµ¥ ÏÜçÏóêÏÑú Î∞úÍ≤¨Ìïú ÎÜÄÎùºÏö¥ ÎπÑÎ∞Ä Î™®Ìóò', author: 'Î∞ïÏÜåÏó∞ Í∏Ä', img: '', type: 'core', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 4, level: 'K2-2', title: 'Íµ¨Î¶Ñ ÏúÑÏùò ÏÑ∏ÏÉÅ', desc: 'Íµ¨Î¶Ñ ÏúÑÏóêÏÑú ÌéºÏ≥êÏßÄÎäî ÌôòÏÉÅÏ†ÅÏù∏ ÌïòÎäò Ïó¨Ìñâ', author: 'ÏµúÏùÄÏòÅ Í∏Ä', img: '', type: 'managed', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]}
            ]
        },
        {
            month: 5, status: 'locked',
            weeks: [
                { week: 1, level: 'K3-1', title: 'ÎØ∏ÎûòÏùò Î∞úÎ™ÖÍ∞Ä', desc: 'ÏûëÏùÄ Î∞úÎ™ÖÏúºÎ°ú ÏÑ∏ÏÉÅÏùÑ Î∞îÍæ∏Îäî Íøà Ïù¥ÏïºÍ∏∞', author: 'ÌïúÏßÄÏùÄ Í∏Ä', img: '', type: 'core', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 2, level: 'K3-1', title: 'Î∞îÎã§Ïùò ÎπÑÎ∞Ä', desc: 'ÍπäÏùÄ Î∞îÎã§ ÏÜç Ïà®Í≤®ÏßÑ Î≥¥Î¨ºÍ≥º ÏÉùÎ¨ºÏùò ÏÑ∏Í≥Ñ', author: 'ÏïÑÎÜÄÎìú Î°úÎ≤®', img: '', type: 'managed', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 3, level: 'K3-1', title: 'Î≥ÑÎπõ ÎßàÏùÑ', author: 'Ïò§ Ìó®Î¶¨', desc: 'Îî∞ÎúªÌïú ÎßàÏùåÏù¥ Î™®Ïù∏ ÏûëÏùÄ ÎßàÏùÑÏùò Ïù¥ÏïºÍ∏∞', img: '', type: 'core', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 4, level: 'K3-1', title: 'ÌïòÎäòÏùÑ ÎÇòÎäî Íøà', desc: 'ÌïòÎäòÏùÑ ÎèôÍ≤ΩÌïòÎäî ÏïÑÏù¥Ïùò ÏïÑÎ¶ÑÎã§Ïö¥ Íøà Ïù¥ÏïºÍ∏∞', author: 'Ïú§ÎèôÏ£º', img: '', type: 'managed', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]}
            ]
        },
        {
            month: 6, status: 'locked',
            weeks: [
                { week: 1, level: 'K3-1', title: 'ÏãúÍ∞Ñ Ïó¨ÌñâÏûê', desc: 'Í≥ºÍ±∞ÏôÄ ÎØ∏ÎûòÎ•º Ïò§Í∞ÄÎäî Ïã†ÎπÑÎ°úÏö¥ ÏãúÍ∞Ñ Î™®Ìóò', author: 'ÎßàÎ•¥Ïø†Ïä§ ÌîºÏä§ÌÑ∞', img: '', type: 'core', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 2, level: 'K3-1', title: 'ÎßàÎ≤ïÏùò Ï†ïÏõê', desc: 'ÎπÑÎ∞Ä Ï†ïÏõêÏóêÏÑú ÌîºÏñ¥ÎÇòÎäî ÏûêÏó∞Í≥º Ìù¨ÎßùÏùò Ïù¥ÏïºÍ∏∞', author: 'Ïû• ÏßÄÏò§ÎÖ∏', img: '', type: 'managed', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 3, level: 'K3-1', title: 'Í≥µÎ£° ÎåÄÌÉêÌóò', desc: 'Í≥µÎ£° ÏãúÎåÄÎ°ú Îñ†ÎÇòÎäî ÏßúÎ¶øÌïú ÌÉêÌóò Ïù¥ÏïºÍ∏∞', author: 'ÌïúÏßÄÏùÄ Í∏Ä', img: '', type: 'core', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]},
                { week: 4, level: 'K3-1', title: 'Ïö∞Ï£º ÌÉêÌóòÎåÄ', desc: 'Ïã†ÎπÑÎ°úÏö¥ Ïö∞Ï£ºÎ•º ÎàÑÎπÑÎäî Ïñ¥Î¶∞Ïù¥ ÌÉêÌóòÎåÄ Ïù¥ÏïºÍ∏∞', author: 'Ïù¥ÏàòÏ†ï Í∏Ä', img: '', type: 'managed', status: 'locked', activities: [
                    { name: 'ÎèÖÌõÑÌÄ¥Ï¶à', icon: 'fa-solid fa-pen-fancy', done: false },
                    { name: 'AI Î¶¨ÌÖîÎßÅ', icon: 'fa-solid fa-microphone', done: false },
                    { name: 'Ïñ¥ÌúòÏ±åÎ¶∞ÏßÄ', icon: 'fa-solid fa-puzzle-piece', done: false }
                ]}
            ]
        }
    ];

    // ============================================================
    //  KRS Levels (for road map)
    // ============================================================
    const krsLevels = [
        { id:'PreK1',label:'PreK1',grade:'Îßå 4~5ÏÑ∏',group:'ÎèÖÏÑúÍ∏∞Ï¥à',groupIcon:'üå±',desc:'ÌïúÍ∏Ä Ìï¥Îìù ÏßëÏ§ë',status:'completed' },
        { id:'PreK2',label:'PreK2',grade:'Îßå 6ÏÑ∏',group:'ÎèÖÏÑúÍ∏∞Ï¥à',groupIcon:'üå±',desc:'Í∏Ä Í≤ΩÌóò ÌôïÎåÄ',status:'completed' },
        { id:'K1-1',label:'K1-1',grade:'Ï¥à1-1',group:'ÎèÖÏÑú Ïú†Ï∞ΩÏÑ±',groupIcon:'üìó',desc:'Ïú†Ï∞ΩÏÑ± Í∏∞Ï¥à',status:'completed' },
        { id:'K1-2',label:'K1-2',grade:'Ï¥à1-2',group:'ÎèÖÏÑú Ïú†Ï∞ΩÏÑ±',groupIcon:'üìó',desc:'Ïú†Ï∞ΩÏÑ± ÌôïÎ≥¥',status:'completed' },
        { id:'K2-1',label:'K2-1',grade:'Ï¥à2-1',group:'ÎèÖÏÑú Ïú†Ï∞ΩÏÑ±',groupIcon:'üìó',desc:'ÍµêÍ≥º Ïó∞Í≥Ñ',status:'completed' },
        { id:'K2-2',label:'K2-2',grade:'Ï¥à2-2',group:'ÎèÖÏÑú ÏàôÎã¨',groupIcon:'üìô',desc:'ÏßÄÏãù Ï≤¥Í≥ÑÌôî',status:'current',booksRead:10 },
        { id:'K3-1',label:'K3-1',grade:'Ï¥à3-1',group:'ÎèÖÏÑú ÏàôÎã¨',groupIcon:'üìô',desc:'ÏßÄÏãù Ï≤¥Í≥ÑÌôî',status:'locked' },
        { id:'K3-2',label:'K3-2',grade:'Ï¥à3-2',group:'ÎèÖÏÑú ÏàôÎã¨',groupIcon:'üìô',desc:'ÏßÄÏãù Ï≤¥Í≥ÑÌôî',status:'locked' },
        { id:'K4',label:'K4',grade:'Ï¥à4',group:'ÎèÖÏÑú Ïã¨Ìôî',groupIcon:'üìï',desc:'ÎπÑÌåêÏ†Å Ïù¥Ìï¥',status:'locked' },
        { id:'K5',label:'K5',grade:'Ï¥à5',group:'ÎèÖÏÑú Ïã¨Ìôî',groupIcon:'üìï',desc:'Ïã¨Ìôî ÎèÖÌï¥',status:'locked' },
        { id:'K6',label:'K6',grade:'Ï¥à6',group:'ÎèÖÏÑú Ïã¨Ìôî',groupIcon:'üìï',desc:'Ïã¨Ìôî ÎèÖÌï¥',status:'locked' },
        { id:'K7',label:'K7',grade:'Ï§ë1',group:'ÎèÖÏÑú Ïã¨Ìôî',groupIcon:'üìï',desc:'Ï†ÑÎ¨∏ ÎèÖÌï¥',status:'locked' },
        { id:'K8',label:'K8',grade:'Ï§ë2~Í≥†1',group:'ÎèÖÏÑú ÌôïÏû•',groupIcon:'üìò',desc:'Í≥†Í∏â ÎèÖÌï¥',status:'locked' },
        { id:'K9',label:'K9',grade:'Í≥†2~ÎåÄ1',group:'ÎèÖÏÑú ÌôïÏû•',groupIcon:'üìò',desc:'ÌïôÏà† Ïù¥Ìï¥',status:'locked' },
        { id:'K10',label:'K10',grade:'ÏÑ±Ïù∏',group:'ÎèÖÏÑú ÌôïÏû•',groupIcon:'üìò',desc:'Ï†ÑÎ¨∏ ÎèÖÌï¥',status:'locked' }
    ];
    const groupColors = {
        'ÎèÖÏÑúÍ∏∞Ï¥à':{bg:'bg-emerald-50',border:'border-emerald-200',text:'text-emerald-700'},
        'ÎèÖÏÑú Ïú†Ï∞ΩÏÑ±':{bg:'bg-sky-50',border:'border-sky-200',text:'text-sky-700'},
        'ÎèÖÏÑú ÏàôÎã¨':{bg:'bg-amber-50',border:'border-amber-200',text:'text-amber-700'},
        'ÎèÖÏÑú Ïã¨Ìôî':{bg:'bg-violet-50',border:'border-violet-200',text:'text-violet-700'},
        'ÎèÖÏÑú ÌôïÏû•':{bg:'bg-indigo-50',border:'border-indigo-200',text:'text-indigo-700'}
    };

    // ============================================================
    //  TAB SWITCHING
    // ============================================================
    let currentTab = 'tree', mapRendered = false;

    function switchTab(tab) {
        if (currentTab === tab) return;
        currentTab = tab;

        // ÌÉ≠ Î≤ÑÌäº ÏÉÅÌÉú ÌÜ†Í∏Ä
        document.getElementById('tab-btn-tree').classList.toggle('active', tab === 'tree');
        document.getElementById('tab-btn-map').classList.toggle('active', tab === 'map');

        // ÏΩòÌÖêÏ∏† Ï†ÑÌôò
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById(tab === 'tree' ? 'tab-tree' : 'tab-map').classList.add('active');
        if (tab === 'map') {
            // Îßµ ÌÉ≠: Ï¶âÏãú topÏúºÎ°ú Ïù¥Îèô ÌõÑ, ÌòÑÏû¨ ÏúÑÏπòÍπåÏßÄ Î∂ÄÎìúÎüΩÍ≤å Ïä§ÌÅ¨Î°§
            document.getElementById('main-scroll').scrollTo({ top: 0, behavior: 'instant' });
            if (!mapRendered) { renderRoadMap(); mapRendered = true; }
            // Î†åÎçîÎßÅ ÏôÑÎ£å ÌõÑ ÌòÑÏû¨ ÏúÑÏπòÎ°ú Î∂ÄÎìúÎüΩÍ≤å Ïä§ÌÅ¨Î°§
            requestAnimationFrame(() => {
                setTimeout(() => {
                    const node = document.querySelector('.b-tile.st-current');
                    if (node) {
                        node.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 300);
            });
        } else {
            document.getElementById('main-scroll').scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

    // Í∏∞Ï°¥ Ìò∏Ï∂ú Ìò∏Ìôò
    function toggleMapView() {
        switchTab(currentTab === 'tree' ? 'map' : 'tree');
    }

    // ============================================================
    //  RENDER MONTH SECTIONS
    // ============================================================
    function renderMonthSections() {
        const container = document.getElementById('month-container');
        let html = '';

        monthlyData.forEach(m => {
            const isCollapsed = m.status === 'completed';
            const statusBadge = m.status === 'completed'
                ? `<span class="month-completed-badge"><i class="fa-solid fa-circle-check"></i> ÌïôÏäµ ÏôÑÎ£å</span>`
                : m.status === 'current'
                ? `<span class="month-completed-badge" style="background:rgba(255,159,67,0.1); color:#FF9F43;"><i class="fa-solid fa-bolt"></i> ÏßÑÌñâ Ï§ë</span>`
                : '';

            const completedClass = m.status === 'completed' ? ' completed' : '';
            html += `
            <div class="month-section${completedClass}" data-month="${m.month}">
                <div class="month-header" onclick="toggleMonth(${m.month})">
                    <span class="month-title-num">${m.month}Í∞úÏõî</span>
                    ${statusBadge}
                    <div class="month-toggle ${isCollapsed ? 'collapsed' : ''}" id="toggle-${m.month}">
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                </div>
                <div class="month-body ${isCollapsed ? 'collapsed' : ''}" id="body-${m.month}">
                    <div class="week-grid">
                        ${m.weeks.map(w => renderWeekCard(w)).join('')}
                    </div>
                </div>
            </div>`;
        });

        container.innerHTML = html;
    }

    function renderWeekCard(w) {
        // Status display
        let statusHtml = '';
        if (w.status === 'completed') {
            statusHtml = '<span class="week-status completed"><i class="fa-solid fa-circle-check"></i> ÌïôÏäµ ÏôÑÎ£å</span>';
        } else if (w.status === 'in-progress') {
            statusHtml = '<span class="week-status in-progress"><i class="fa-solid fa-spinner fa-spin"></i> ÏßÑÌñâ Ï§ë</span>';
        } else {
            statusHtml = '<span class="week-status locked"><i class="fa-solid fa-lock"></i> Ïû†ÍπÄ</span>';
        }

        // Book cover
        let coverHtml = '';
        if (w.img) {
            coverHtml = `<img src="${w.img}" alt="${w.title}" onerror="this.parentNode.innerHTML='<div class=\\'book-cover-placeholder\\'><i class=\\'fa-solid fa-book-open\\'></i><span>READING TREE</span></div>'">`;
        } else {
            coverHtml = `<div class="book-cover-placeholder"><i class="fa-solid fa-book-open"></i><span>READING TREE</span></div>`;
        }

        // Activities
        const activitiesHtml = w.activities.map(a => {
            const doneClass = a.done ? 'done' : '';
            const doneIcon = a.done ? '<i class="fa-solid fa-check"></i>' : '';
            return `<span class="activity-badge ${doneClass}"><i class="${a.icon}"></i>${a.name}${doneIcon}</span>`;
        }).join('');

        const cardClass = w.status === 'in-progress' ? 'week-card in-progress' : 'week-card';

        return `
        <div class="${cardClass}">
            <div class="week-card-header">
                <div class="week-badge">
                    <span class="week-num">${w.week}Ï£ºÏ∞®</span>
                    <span class="week-level">${w.level}</span>
                </div>
                ${statusHtml}
            </div>
            <div class="week-card-body">
                <div class="book-cover-box">
                    ${coverHtml}
                </div>
                <div class="book-info">
                    <div class="book-title">${w.title}</div>
                    ${w.desc ? `<div class="book-desc">${w.desc}</div>` : ''}
                    <div class="book-author">${w.author}</div>
                </div>
            </div>
            <div class="activity-section">
                <div class="activity-label">ÌïôÏäµ ÌôúÎèô</div>
                <div class="activity-badges">
                    ${activitiesHtml}
                </div>
            </div>
        </div>`;
    }

    // ============================================================
    //  TOGGLE MONTH
    // ============================================================
    function toggleMonth(monthNum) {
        const body = document.getElementById('body-' + monthNum);
        const toggle = document.getElementById('toggle-' + monthNum);
        body.classList.toggle('collapsed');
        toggle.classList.toggle('collapsed');
    }

    // ============================================================
    //  ROAD MAP
    // ============================================================
    // Book Band ÏÉâÏÉÅ (Oxford Reading Tree Ï∞∏Í≥†)
    const bandColors = {
        'ÎèÖÏÑúÍ∏∞Ï¥à':  '#C084FC', // Lilac/Pink
        'ÎèÖÏÑú Ïú†Ï∞ΩÏÑ±': '#38BDF8', // Blue/Turquoise
        'ÎèÖÏÑú ÏàôÎã¨':  '#FB923C', // Orange/Gold
        'ÎèÖÏÑú Ïã¨Ìôî':  '#A78BFA', // Purple
        'ÎèÖÏÑú ÌôïÏû•':  '#818CF8', // Indigo
    };

    function renderRoadMap() {
        const container = document.getElementById('rmap-container');
        const completed = krsLevels.filter(l => l.status === 'completed').length;
        const current = krsLevels.find(l => l.status === 'current');
        const total = krsLevels.length;

        // „ÑπÏûê Í≤ΩÎ°ú: 5Ïó¥ √ó 7Ìñâ
        // Row 1 (‚Üí): START, PreK1, PreK2, K1-1, K1-2
        //                                         ‚Üì bridge (col 5)
        // Row 2 (‚Üê): K3-2, K3-1, K2-2‚òÖ, K2-1, ÎèÖÏÑúÏÑ¨
        // ‚Üì bridge (col 1)
        // Row 3 (‚Üí): Ìô©Í∏àÏó¥Ïá†, K4, K5, K6, K7
        //                                   ‚Üì bridge (col 5)
        // Row 4 (‚Üê): GOAL, K10, K9, K8, Î≥¥ÎÑàÏä§
        const boardTiles = [
            // Row 1 (‚Üí): grid-row 1
            { r:1, c:1, type:'special', id:'start', icon:'üöÄ', label:'Ï∂úÎ∞ú', cls:'start-tile' },
            { r:1, c:2, type:'level', idx:0 },   // PreK1
            { r:1, c:3, type:'level', idx:1 },   // PreK2
            { r:1, c:4, type:'level', idx:2 },   // K1-1
            { r:1, c:5, type:'level', idx:3 },   // K1-2
            // Bridge (grid-row 2, col 5) - full-size connector
            { r:2, c:5, type:'bridge', dir:'down-left' },
            // Row 2 (‚Üê): grid-row 3
            { r:3, c:5, type:'special', id:'island', icon:'üèùÔ∏è', label:'ÎèÖÏÑúÏÑ¨', cls:'island-tile' },
            { r:3, c:4, type:'level', idx:4 },   // K2-1
            { r:3, c:3, type:'level', idx:5 },   // K2-2 (ÌòÑÏû¨)
            { r:3, c:2, type:'level', idx:6 },   // K3-1
            { r:3, c:1, type:'level', idx:7 },   // K3-2
            // Bridge (grid-row 4, col 1)
            { r:4, c:1, type:'bridge', dir:'down-right' },
            // Row 3 (‚Üí): grid-row 5
            { r:5, c:1, type:'special', id:'key', icon:'üóùÔ∏è', label:'Ìô©Í∏àÏó¥Ïá†', cls:'key-tile' },
            { r:5, c:2, type:'level', idx:8 },   // K4
            { r:5, c:3, type:'level', idx:9 },   // K5
            { r:5, c:4, type:'level', idx:10 },  // K6
            { r:5, c:5, type:'level', idx:11 },  // K7
            // Bridge (grid-row 6, col 5)
            { r:6, c:5, type:'bridge', dir:'down-left' },
            // Row 4 (‚Üê): grid-row 7
            { r:7, c:5, type:'special', id:'bonus', icon:'üéÅ', label:'Î≥¥ÎÑàÏä§', cls:'bonus-tile' },
            { r:7, c:4, type:'level', idx:12 },  // K8
            { r:7, c:3, type:'level', idx:13 },  // K9
            { r:7, c:2, type:'level', idx:14 },  // K10
            { r:7, c:1, type:'special', id:'goal', icon:'üèÜ', label:'ÏôÑÏ£º', cls:'goal-tile' },
        ];

        let tilesHtml = '';

        boardTiles.forEach(t => {
            const pos = `grid-row:${t.r}; grid-column:${t.c};`;

            if (t.type === 'bridge') {
                const arrowIcon = t.dir === 'down-left' ? 'fa-arrow-turn-down' : 'fa-arrow-turn-down fa-flip-horizontal';
                tilesHtml += `
                <div class="b-bridge" style="${pos}">
                    <i class="fa-solid ${arrowIcon}"></i>
                </div>`;
            } else if (t.type === 'special') {
                tilesHtml += `
                <div class="b-tile corner-tile ${t.cls}" style="${pos}">
                    <div class="corner-icon">${t.icon}</div>
                    <div class="corner-label">${t.label}</div>
                </div>`;
            } else {
                const lv = krsLevels[t.idx];
                const bc = bandColors[lv.group] || '#9ca3af';
                const stClass = lv.status === 'completed' ? 'st-completed' : lv.status === 'current' ? 'st-current' : 'st-locked';

                let statusIcon = '';
                if (lv.status === 'completed') {
                    statusIcon = '<div class="tile-status-icon"><i class="fa-solid fa-circle-check"></i></div>';
                } else if (lv.status === 'locked') {
                    statusIcon = '<div class="tile-status-icon" style="color:#c8c0b4;"><i class="fa-solid fa-lock" style="font-size:9px;"></i></div>';
                }

                const avatar = lv.status === 'current' ? '<div class="tile-avatar">üêøÔ∏è</div>' : '';

                tilesHtml += `
                <div class="b-tile ${stClass}" style="${pos}">
                    <div class="tile-band" style="background:${bc};"></div>
                    ${avatar}
                    <div class="tile-lv">${lv.label}</div>
                    <div class="tile-grade">${lv.grade}</div>
                    ${statusIcon}
                </div>`;
            }
        });

        // Í∑∏Î£π ÏÉâÏÉÅ Ïπ©
        const groupNames = Object.keys(bandColors);
        const groupChipsHtml = groupNames.map(g =>
            `<div class="group-chip"><div class="group-dot" style="background:${bandColors[g]};"></div><div class="group-name">${g}</div></div>`
        ).join('');

        container.innerHTML = `
        <div class="board-title">
            <h3>üëü KRS Î¶¨Îî© Ïä§ÌÉ≠</h3>
            <p>PreK1 ~ K10 ¬∑ Ï¥ù ${total}Îã®Í≥Ñ</p>
        </div>
        <div class="board-summary">
            <div class="bs-item">
                <div class="bs-num" style="color:#10b981;">${completed}</div>
                <div class="bs-label">ÏôÑÎ£å Îã®Í≥Ñ</div>
            </div>
            <div class="bs-divider"></div>
            <div class="bs-item">
                <div class="bs-num" style="color:#FF9F43;">${current ? current.label : '-'}</div>
                <div class="bs-label">ÌòÑÏû¨ Îã®Í≥Ñ</div>
            </div>
            <div class="bs-divider"></div>
            <div class="bs-item">
                <div class="bs-num" style="color:#94a3b8;">${total - completed - 1}</div>
                <div class="bs-label">ÎÇ®ÏùÄ Îã®Í≥Ñ</div>
            </div>
            <div class="bs-divider"></div>
            <div class="bs-item">
                <div class="bs-num" style="color:#8b5cf6;">${total}</div>
                <div class="bs-label">Ï†ÑÏ≤¥</div>
            </div>
        </div>
        <div class="board-frame">
            <div class="board-grid">
                ${tilesHtml}
            </div>
        </div>
        <div class="board-legend">
            <div class="legend-item"><div class="legend-dot" style="background:#10b981;"></div>ÏôÑÎ£å</div>
            <div class="legend-item"><div class="legend-dot" style="background:linear-gradient(135deg,#FF9F43,#F368E0);"></div>ÌòÑÏû¨</div>
            <div class="legend-item"><div class="legend-dot" style="background:#b8b0a4;"></div>Ïû†ÍπÄ</div>
            <div class="legend-item"><span style="font-size:11px;">üöÄ</span>Ï∂úÎ∞ú</div>
            <div class="legend-item"><span style="font-size:11px;">üèÜ</span>ÏôÑÏ£º</div>
        </div>
        <div class="board-groups">${groupChipsHtml}</div>`;
    }

    // ============================================================
    //  UTILS
    // ============================================================
    function openBookViewer() {
        sessionStorage.setItem('currentBook', JSON.stringify({ title:'Ïò§Ï¶àÏùò ÎßàÎ≤ïÏÇ¨', type:'ÏΩîÏñ¥Î∂Å', level:'K2-2', currentBookPage:1, totalPages:8, week:1 }));
        window.location.href = 'book-viewer.html';
    }

    // ============================================================
    //  INIT
    // ============================================================
    document.addEventListener('DOMContentLoaded', () => {
        loadSidebar('library');
        loadLogoutModal();
        renderMonthSections();
    });
    </script>
</body>
</html>
